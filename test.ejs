const loadHomepage = async (req, res) => {
    try {
        const user=req.session.user;
        const categories=await Category.find({isListed:true})
        let productData=await Product.find({isBlocked:false,category:{$in:categories.map(category=>category._id)}})
        productData.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt))
        productData=productData.slice(0,8);
        res.setHeader('Cache-Control', 'no-store');
        if(user){
            if (user.isDemo) {
                res.render("home", { user: user.username, products: productData });
            }else{
            const userData=await User.findOne({_id:user.id})
            res.render("home",{user:userData.username,products:productData})
            }
        }else{

return res.render("home",{products:productData});
        }
        
    } catch (error) {
        console.error(error)
        console.log("homepage not found");
        res.status(500).send("server error");
    }
};