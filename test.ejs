const editProduct=async(req,res)=>{
    try {
        const id=req.params.id;
        const product=await Product.findOne({_id:id});
        const data=req.body;
        const existingProduct=await Product.findOne({
            productName:data.productName,
            _id:{$ne:id}
        })
        if(existingProduct){
            return res.status(400).json({error:"Product with this name already exists.please try with another name"})
        }
        const images=[];
        if(req.files&&req.files.length>0){
            for(let i=0;i<req.files.length;i++){
                images.push(req.files[i].filename)
            }
        }
        const updateFields={
            productName:data.productName,
            description:data.description,
            category:product.category,
            regularPrice:data.regularPrice,
            salePrice:data.salePrice,
            quantity:data.quantity,
            size:data.size,
            color:data.color
        }
        if (req.files.length > 0) {
            await Product.findByIdAndUpdate(id, {
                $push: { productImage: { $each: images } },
                $set: updateFields
            }, { new: true });
        } else{

         await Product.findByIdAndUpdate(id,updateFields,{new:true});
        res.redirect("/admin/products")
        }
       
        
    } catch (error) {
        console.error(error)
        res.redirect("/pageError")

        
    }
}